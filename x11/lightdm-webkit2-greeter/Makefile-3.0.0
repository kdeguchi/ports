PORTNAME=	lightdm-webkit2-greeter
PORTVERSION=	3.0.0rc2
CATEGORIES=	x11

MAINTAINER=	ericbsd@FreeBSD.org
COMMENT=	Web Greeter for LightDM
WWW=		https://github.com/antergos/web-greeter

LICENSE=	GPLv3

BUILD_DEPENDS=	bash:shells/bash \
		gsed:textproc/gsed \
		pyrcc5:devel/py-qt5-pyqt
LIB_DEPENDS=	libdbus-glib-1.so:devel/dbus-glib \
		liblightdm-gobject-1.so:x11/lightdm \
		libwebkit2gtk-4.0.so:www/webkit2-gtk3

#USES=		gettext gmake gnome localbase meson pkgconfig python shebangfix xorg
USES=		gettext gmake gnome localbase pkgconfig python shebangfix xorg
USE_GNOME=	glib20 gtk30
USE_XORG=	x11

USE_GITHUB=	yes
GH_ACCOUNT=	Antergos
GH_TAGNAME=	9252419

WRKSRC=	${WRKDIR}/web-greeter-${GH_TAGNAME}

#MESON_BUILD_DIR=	build

SHEBANG_FILES=	build/utils.sh

MAKE_ARGS+=	config_dir=${PREFIX}/etc/lightdm
MAKE_JOBS_UNSAFE=	yes

post-patch:
#	${REINPLACE_CMD} -e 's@/usr@${PREFIX}@;s@/etc@${PREFIX}/etc@' ${WRKSRC}/meson_options.txt ${WRKSRC}/data/lightdm-webkit2-greeter.conf ${WRKSRC}/man/${PORTNAME}.1
#	${REINPLACE_CMD} -e 's@canonicalize_file_name(file_path)@realpath(file_path, NULL)@' ${WRKSRC}/src/webkit2-extension.c
	${REINPLACE_CMD} -e 's@/etc@$${PREFIX}/etc@;s@-fprint@>@;s@/tmp/@${WRKSRC}/@;s@cp -R -t .*@cp -vR "$${REPO_DIR}/web-greeter" "$${REPO_DIR}/dist"  "$${BUILD_DIR}"@;s@@@;s@sed @gsed @' ${WRKSRC}/build/utils.sh
	${REINPLACE_CMD} -e 's@/usr/lib/at-spi2-core@/usr/local/libexec@' ${WRKSRC}/web-greeter/whither.yml

#post-install:
#	${MV} ${STAGEDIR}${PREFIX}/etc/lightdm/${PORTNAME}.conf \
#		${STAGEDIR}${PREFIX}/etc/lightdm/${PORTNAME}.conf.sample

.include <bsd.port.mk>
